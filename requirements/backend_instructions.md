# Project overview
Use this guide to build backend for the web app of emoji maker

# Tech stack
- We will use Next.js, Supabase, Clerk

# Tables & buckets already created
Supabase storage Bucket: "emojis"

TABLE emojis (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    image_url TEXT NOT NULL,
    prompt TEXT NOT NULL,
    likes_count NUMERIC DEFAULT 0,
    creator_user_id TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
TABLE profiles (
    user_id TEXT PRIMARY KEY,
    credits INTEGER DEFAULT 3 NOT NULL,
    tier TEXT NOT NULL DEFAULT 'free' CHECK (tier IN ('free', 'pro')),
    stripe_customer_id TEXT,
    stripe_subscription_id TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);

# Requirements

1. Create user to user table
   1. After a user signs in via Clerk, we should get the userId from Clerk, and check if this userId exists in the 'profiles' table, matching "user_id."
   2. If the user doesn't exist, then create a user in 'profiles' table.
   3. If the user exists already, then proceed and pass on user_id to functions like generating emojis.

2. Upload emoji to "emojis" Supabase storage bucket:
   1. When a user is generating an emoji, upload the emoji image file returned from Replicate to Supabase "emojis" storage bucket.
   2. Add the image URL to the "emojis" data table as "image_url," and creator_user_id to be the actual user_id.

3. Display all images in emojigrid:
   1. Emoji grid should fetch and display all images from "emojis" data table.
   2. When a new emoji is generated, the emojigrid should be updated automatically to add the new emoji to the grid.

4. Likes interaction:
   1. When a user checks the 'like' button, the num_likes should increase on the 'emojis' table.
   2. When a user un-checks the 'like' button, the num_likes should decrease on the 'emojis' table.


# Documentations
## Example of uploading files to Supabase storage
import { createClient } from '@supabase/supabase-js'

// Create Supabase client
const supabase = createClient('your_project_url', 'your_supabase_api_key')

// Upload file using standard upload
async function uploadFile(file) {
   const { data, error } = await supabase.storage.from('bucket_name').upload('file_path', file)
   if (error) {
       // Handle error
   } else {
       // Handle success
   }
}